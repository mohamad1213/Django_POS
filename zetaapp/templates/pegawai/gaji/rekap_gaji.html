{% extends 'base_absensi.html' %}{% load static %}
{% load sass_tags %}
{% load humanize %}
{% load sass_tags %}
{% block css %}
<!-- Plugins css start-->
<link rel="stylesheet" type="text/css" href="{% sass_src 'assets/scss/vendors/scrollbar.scss' %}">
<link rel="stylesheet" type="text/css" href="{% sass_src 'assets/scss/vendors/datatables.scss' %}">
<link rel="stylesheet" type="text/css" href="{% sass_src 'assets/scss/vendors/owlcarousel.scss' %}">
<link rel="stylesheet" type="text/css" href="{% sass_src 'assets/scss/vendors/rating.scss' %}">
<!-- Plugins css Ends-->
{% endblock css %}
{% block content %}
<div class="page-body">
    {% include 'layout/breadcrumb.html' %}

    <!-- Container-fluid starts-->
    <div class="container-fluid list-products">
        <div class="row">
            <!-- Individual column searching (text inputs) Starts-->
            <div class="col-sm-12">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h2 class="text-center">Rekap Gaji Pegawai</h2>
                        <p class="text-center">Periode: <strong>{{ minggu_mulai }}</strong> - <strong>{{ minggu_selesai
                                }}</strong></p>
                        <h4 class="mb-0">Gaji Pegawai Harian</h4>
                    </div>
                    <div class="card-body">
                        <table class="table table-striped table-bordered text-center">
                            <thead class="table-dark">
                                <tr>
                                    <th>Nama Pegawai</th>
                                    <th>Total Kehadiran</th>
                                    <th>Gaji per Hari</th>
                                    <th>Total Gaji</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for gaji in gaji_harian_list %}
                                <tr>
                                    <td>{{ gaji.pegawai.nama }}</td>
                                    <td>{{ gaji.total_hadir }}</td>
                                    <td>Rp {{ gaji.pegawai.gaji_harian|floatformat:2 }}</td>
                                    <td>Rp {{ gaji.total_gaji|floatformat:2 }}</td>
                                    <td>
                                        <a href="{% url 'pegawai:generate_slip_gaji' gaji.pegawai.id %}"
                                            class="btn btn-sm btn-success" target="_blank">ðŸ“„ Lihat Slip</a>
                                        <button class="btn btn-sm btn-danger"
                                            onclick="printSlip('{{ gaji.pegawai.id }}')">ðŸ–¨ Print</button>
                                    </td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="5" class="text-center text-muted">Tidak ada data</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Gaji Pegawai Borongan -->
                <div class="card">
                    <div class="card-header bg-success text-white">
                        <h4 class="mb-0">Gaji Pegawai Borongan</h4>
                    </div>
                    <div class="card-body">
                        <table class="table table-striped table-bordered text-center">
                            <thead class="table-dark">
                                <tr>
                                    <th>Nama Pegawai</th>
                                    <th>Total KG</th>
                                    <th>Harga per KG</th>
                                    <th>Total Gaji</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for gaji in gaji_borongan_list %}
                                <tr>
                                    <td>{{ gaji.pegawai.nama }}</td>
                                    <td>{{ gaji.total_kg }}</td>
                                    <td>Rp {{ gaji.harga_per_kg|floatformat:2 }}</td>
                                    <td>Rp {{ gaji.total_gaji|floatformat:2 }}</td>
                                    <td>
                                        <a href="{% url 'pegawai:generate_slip_gaji' gaji.pegawai.id %}"
                                            class="btn btn-sm btn-success" target="_blank">ðŸ“„ Lihat Slip</a>
                                        <button class="btn btn-sm btn-danger"
                                            onclick="printSlip('{{ gaji.pegawai.id }}')">ðŸ–¨ Print</button>
                                    </td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="5" class="text-center text-muted">Tidak ada data</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function printSlip(pegawaiId) {
        var slipUrl = "{% url 'pegawai:generate_slip_gaji' 0 %}".replace('0', pegawaiId);
        var win = window.open(slipUrl, '_blank');
        win.onload = function () {
            win.print();
        };
    }
</script>
{% endblock %}