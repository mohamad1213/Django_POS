{% extends 'base.html' %}{% load static %}
{% load sass_tags %}
{% block css %}
<!-- Plugins css start-->
<link rel="stylesheet" type="text/css" href="{% sass_src 'assets/scss/vendors/scrollbar.scss' %}">
<link rel="stylesheet" type="text/css" href="{% sass_src 'assets/scss/vendors/datatables.scss' %}">
<link rel="stylesheet" type="text/css" href="{% sass_src 'assets/scss/vendors/owlcarousel.scss' %}">
<link rel="stylesheet" type="text/css" href="{% sass_src 'assets/scss/vendors/rating.scss' %}">
<!-- Plugins css Ends-->
{% endblock css %}
{% block content %}
<div class="page-body">
    {% include 'layout/breadcrumb.html' %}


    <div class="container-fluid list-products">
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header pb-0">
                        <div class="order-place text-md-end">
                            <button type="button" class="btn btn-primary font-weight-bold w-md-auto"
                                data-bs-toggle="modal" data-bs-target="#createCategoryModal">
                                <i class="fas fa-plus me-2"></i>
                                Create new category
                            </button>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <div class="card-body">
                            <table class="table table-bordered table-hover" id="dataTable" width="100%" cellspacing="0">
                                <thead>
                                    <tr>
                                        <th class="d-none d-md-table-cell">ID</th>
                                        <th>#</th>
                                        <th>Name</th>
                                        <th class="d-none d-sm-table-cell">Description</th>
                                        <th class="text-center" style="width:15%">Status</th>
                                        <th class="text-center" style="width:15%">Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for c in categories %}
                                    <tr>
                                        <td class="d-none d-md-table-cell">{{c.id}}</td>
                                        <td>{{forloop.counter}}</td>
                                        <td>{{c.name}}</td>
                                        <td class="d-none d-sm-table-cell">{{c.description}}</td>

                                        {% if c.status == "ACTIVE" %}
                                        <td class="text-center">
                                            <span class="badge badge-success"
                                                style="font-size:0.8em;">{{c.status}}</span>
                                        </td>
                                        {% elif c.status == "INACTIVE" %}
                                        <td class="text-center">
                                            <span class="badge badge-danger"
                                                style="font-size:0.8em;">{{c.status}}</span>
                                        </td>
                                        {% endif %}

                                        <td class="text-center">
                                            <div class="d-flex justify-content-center flex-column flex-sm-row gap-1">
                                                <a href="{% url 'products:categories_update' c.id %}"
                                                    class="text-decoration-none">
                                                    <button type="button" class="btn btn-warning btn-sm"
                                                        data-bs-toggle="tooltip" title="Update category">
                                                        <i class="fas fa-pen"></i>
                                                    </button>
                                                </a>
                                                <a class="text-decoration-none">
                                                    <button rel="delete" type="button" class="btn btn-danger btn-sm"
                                                        data-bs-toggle="modal" data-bs-target="#exampleModal">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </a>
                                            </div>
                                        </td>
                                    </tr>
                                    <div class="modal fade" id="exampleModal" tabindex="-1"
                                        aria-labelledby="exampleModalLabel" aria-hidden="true">
                                        <div class="modal-dialog">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h5 class="modal-title" id="exampleModalLabel">Delete
                                                        category</h5>
                                                    <button type="button" class="close" data-bs-dismiss="modal"
                                                        aria-label="Close">
                                                        <span aria-hidden="true">&times;</span>
                                                    </button>
                                                </div>
                                                <div id="updateThisText" class="modal-body">
                                                    Are you sure you want to delete the category: {{c.name}}
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-secondary"
                                                        data-dismiss="modal">Cancel</button>
                                                    <a id="updateThisURL"
                                                        href="{% url 'products:categories_delete' c.id %}"
                                                        class="text-decoration-none">
                                                        <button type="button" class="btn btn-danger">Delete</button>
                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    {% endfor %}
                                </tbody>
                                <div class="modal fade" id="createCategoryModal" tabindex="-1"
                                    aria-labelledby="createCategoryModalLabel" aria-hidden="true">
                                    <div class="modal-dialog">
                                        <div class="modal-content">

                                            <div class="modal-header">
                                                <h5 class="modal-title" id="createCategoryModalLabel">Tambah Kategori
                                                    Baru</h5>
                                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                    aria-label="Close"></button>
                                            </div>

                                            <form class="form theme-form" method="POST" enctype="multipart/form-data">

                                                <div class="modal-body">
                                                    {% load crispy_forms_tags %}
                                                    {% csrf_token %}

                                                    <div class="mb-3">
                                                        <label class="col-form-label pt-0">Name</label>
                                                        {{form.name}}
                                                    </div>

                                                    <div class="mb-3">
                                                        <label class="col-form-label pt-0">Description</label>
                                                        {{form.description}}
                                                    </div>

                                                    <div class="mb-3">
                                                        <label class="col-form-label pt-0">Status</label>
                                                        {{form.status}}
                                                    </div>

                                                    {% if form.errors %}
                                                    <div class="alert alert-danger" id="msg">
                                                        {{ form.errors }}
                                                    </div>
                                                    {% endif %}

                                                </div>
                                                <div
                                                    class="modal-footer border-0 pt-0 d-flex flex-column-reverse flex-sm-row justify-content-end gap-2">
                                                    <button class="btn btn-warning w-100 w-sm-auto" type="reset"
                                                        data-bs-dismiss="modal">Cancel</button>

                                                    <button class="btn btn-primary w-100 w-sm-auto"
                                                        type="submit">Submit</button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Specific Page JS goes HERE  -->
    {% endblock content %}
    {% block scriptcontent %}
    <!-- Plugins JS start-->
    <script src="{% static 'assets/js/sidebar-menu.js' %}"></script>
    <script src="{% static 'assets/js/datatable/datatables/jquery.dataTables.min.js' %}"></script>

    <!-- Plugins JS Ends-->
    <!--Datatables-->
    <script>
        // Call the dataTables jQuery plugin
        $(document).ready(function () {
            tblCategories = $('#dataTable').DataTable({
                dom: 'Bfrtip', // Buttons are draw at this element
                buttons: [
                    {
                        extend: 'print',
                        text: 'Print <i class="fas fa-file ml-2"></i>',
                        titleAttr: 'Print',
                        className: 'btn btn-info',
                        exportOptions: {
                            columns: [0, 1, 2, 3, 4]
                        }
                    },
                    {
                        extend: 'excelHtml5',
                        text: 'Download Excel <i class="fas fa-file-excel ml-2"></i>',
                        titleAttr: 'Download Excel',
                        className: 'btn btn-success ml-2',
                        exportOptions: {
                            columns: [0, 1, 2, 3, 4]
                        }
                    },
                    {
                        extend: 'pdfHtml5',
                        text: 'Download PDF <i class="fas fa-file-pdf ml-2"></i>',
                        titleAttr: 'Download PDF',
                        className: 'btn btn-danger ml-2',
                        download: 'open',
                        orientation: 'vertical',
                        pageSize: 'A4',
                        title: '*',
                        exportOptions: {
                            columns: [0, 1, 2, 3, 4]
                        },
                        customize: function (doc) {
                            doc.styles = {
                                header: {
                                    fontSize: 18,
                                    bold: true,
                                    alignment: 'center'
                                },
                                subheader: {
                                    fontSize: 13,
                                    bold: true
                                },
                                quote: {
                                    italics: true
                                },
                                small: {
                                    fontSize: 8
                                },
                                tableHeader: {
                                    bold: true,
                                    fontSize: 11,
                                    color: 'white',
                                    fillColor: '#2d4154',
                                    alignment: 'center'
                                }
                            };
                            doc.content[1].table.widths = ['10%', '10%', '30%', '30%', '20%'];
                            doc.content[1].margin = [0, 35, 0, 0];
                            doc.content[1].layout = {};
                            doc['footer'] = (function (page, pages) {
                                return {
                                    columns: [
                                        {
                                            alignment: 'left',
                                            text: ['Creation date: ', { text: moment().format('MM-DD-YYYY (HH:mm:ss)') }]
                                        },
                                        {
                                            alignment: 'right',
                                            text: ['page ', { text: page.toString() }, ' de ', { text: pages.toString() }]
                                        }
                                    ],
                                    margin: 20
                                }
                            });

                        }
                    }
                ],
                deferRender: true,
                columnDefs: [
                    {
                        targets: [0],
                        visible: false,
                        searchable: false,
                    },
                    {
                        targets: [-1], // column index (start from 0)
                        orderable: false, // set orderable false for selected columns
                    }
                ],
            });
        });

        // Alert when trying to delete a category
        $('#dataTable tbody')
            // Event when whe try to delete a category
            // We update the text, and href of the modal delete button
            .on('click', 'button[rel="delete"]', function () {
                // Row variable
                var tr = tblCategories.cell($(this).closest('td, li')).index();
                row_data = (tblCategories.row(tr.row).data());
                category_id = row_data[0];
                category_name = row_data[2]
                new_delete_url = 'categories/delete/' + category_id;
                document.getElementById("updateThisText").innerHTML = "Are you sure you want to delete the category:  " + category_name + "?";
                document.getElementById("updateThisURL").href = new_delete_url;
            });
    </script>
    {% endblock scriptcontent %}